\documentclass[a4paper,12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T2A]{fontenc}
\usepackage[russian]{babel}
\usepackage{geometry}
\geometry{margin=1in}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{hyperref}

\lstset{
    basicstyle=\ttfamily\small,
    breaklines=true,
    frame=single,
    keywordstyle=\color{blue},
    commentstyle=\color{gray},
    stringstyle=\color{purple},
}

\title{Отчет по аудиту безопасности приложения}
\author{Ваше имя}
\date{\today}

\begin{document}

\maketitle

\section*{Введение}
Цель данного аудита — выявить и устранить уязвимости в приложении, включая XSS, Information Disclosure, SQL Injection, CSRF, Include и Upload. В отчете представлены методы защиты и примеры кода.

\section{XSS (Cross-Site Scripting)}
XSS позволяет злоумышленнику внедрить вредоносный скрипт, который выполняется в браузере пользователя. В моем приложении данные пользователя выводились без экранирования.

Для защиты я применил функцию \texttt{htmlspecialchars()} ко всем данным, выводимым на страницу.

\begin{lstlisting}[language=PHP, caption=Защита от XSS]
# До исправления (admin.php)
<td><?php echo \$app['fio']; ?></td>

# После исправления
<td><?php echo htmlspecialchars(\$app['fio'], ENT_QUOTES, 'UTF-8'); ?></td>
\end{lstlisting}

\section{Information Disclosure}
Уязвимость связана с раскрытием конфиденциальной информации, например, ошибок подключения к базе данных.

Я отключил отображение ошибок и заменил вывод на общее сообщение, логи записываются в файл.

\begin{lstlisting}[language=PHP, caption=Защита от Information Disclosure]
# До исправления (db_connect.php)
die('Ошибка подключения: ' . \$e->getMessage());

# После исправления
ini_set('display_errors', 0);
error_log(\$e->getMessage(), 3, 'errors.log');
die('Произошла ошибка. Обратитесь к администратору.');
\end{lstlisting}

\section{SQL Injection}
SQL-инъекции позволяют злоумышленнику выполнять произвольные запросы. В моем коде уже использовались подготовленные запросы PDO, что обеспечивает защиту.

\begin{lstlisting}[language=PHP, caption=Защита от SQL Injection]
# Пример безопасного запроса (admin.php)
\$stmt = \$pdo->prepare('SELECT password_hash FROM admins WHERE login = ?');
\$stmt->execute([\$admin_login]);
\end{lstlisting}

\section{CSRF (Cross-Site Request Forgery)}
CSRF позволяет выполнять действия от имени авторизованного пользователя. Формы в моем приложении не были защищены.

Я добавил CSRF-токены в формы и проверяю их при обработке.

\begin{lstlisting}[language=PHP, caption=Защита от CSRF]
# Генерация токена (form.php)
\$_SESSION['csrf_token'] = bin2hex(random_bytes(32));
echo '<input type="hidden" name="csrf_token" value="' . \$_SESSION['csrf_token'] . '">';

# Проверка токена
if (!isset(\$_POST['csrf_token']) || \$_POST['csrf_token'] !== \$_SESSION['csrf_token']) {
    die('Неверный CSRF-токен');
}
\end{lstlisting}

\section{Include и Upload}
Include-уязвимость связана с включением произвольных файлов, а Upload — с загрузкой вредоносных файлов. Загрузки файлов в моем приложении нет, поэтому Upload-уязвимости нет.

Для Include я добавил проверку существования файлов.

\begin{lstlisting}[language=PHP, caption=Защита от Include]
# До исправления (form.php)
require_once 'db_connect.php';

# После исправления
\$file = 'db_connect.php';
if (file_exists(\$file)) {
    require_once \$file;
} else {
    die('Файл не найден');
}
\end{lstlisting}

\section*{Заключение}
В ходе аудита я устранил уязвимости XSS, Information Disclosure, SQL Injection, CSRF и Include. Код доступен по ссылке: \url{https://davidgulikan.github.io/web7/}.

\end{document}
